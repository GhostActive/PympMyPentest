"""
collector.py - contains abstract class for processing objects
"""
# 
# GNU General Public License v3.0
#
# Copyright (c) 2020-2021 GhostActive
#
# For more information see
#   https://github.com/GhostActive/PympMyPentest
#
from abc import abstractmethod, ABC
from typing import Any, Iterable


class Collector(ABC):
    """
    Abstract class to encapsulate processing steps (loading, filtering and
    editing) of objects. An concrete implementation can override the abstract
    methods or extends them using decorators.

    For more information, see
        https://github.com/GhostActive/PympMyPentest/blob/main/doc/collector.md
    """

    @abstractmethod
    def accept(self, obj: Any) -> bool:
        """
        Checks whether the given object is valid or not.

        Args:
            obj: object to be checked

        Returns:
            Returns 'True' if the given object is valid; Otherwise 'False'. The
            default value is 'True'.
        """
        return True

    @abstractmethod
    def modify(self, obj: Any) -> Any:
        """
        Transforms the raw object into the required format for further
        processing.

        Args:
            obj: given object

        Returns:
            Returns the modified object.
        """
        return obj

    @abstractmethod
    def supply(self, *args, **kwargs) -> Iterable[Any]:
        """
        This method returns a sequence of raw objects from one or more data
        sources.

        Args:
            args: positional arguments used by supplier
            kwargs: keyword arguments used by supplier

        Returns:
            Returns a sequence of objects for processing. By default the method
            parameter 'iterable' is returned.
        """
        pass

    def collect(self, *args, **kwargs) -> Iterable[Any]:
        """
        Reads a (filtered) sequence of (modified) objects from a supplier.

        Args:
            args: positional arguments used by supplier
            kwargs: keyword arguments used by supplier

        Returns:
            Returns a generator object processing all items from the given
            supplier.
        """
        return (self.modify(obj) for obj in self.supply(*args, **kwargs) if self.accept(obj))
