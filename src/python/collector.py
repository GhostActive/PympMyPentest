"""
collector.py - contains abstract class for processing objects
"""
# 
# GNU General Public License v3.0
#
# Copyright (c) 2020-2021 GhostActive
#
# For more information see
#   https://github.com/GhostActive/PympMyPentest
#
from abc import abstractmethod, ABC
from typing import Any, Iterable


class Collector(ABC):
    """
    Abstract class for encapsulating input-based steps for reading, filtering
    and modifying objects from one or more data sources to provide a basis for
    further processing steps.

    By invoke the method "collect()" the internal pipeline calls first the
    method "supply" to read the objects from the given data source(s). Each
    read object passes after that the method "accept()" to filter, whether the
    object is valid or not for the further processing. If the read object is
    valid, it can be modified before leaving the "collect()" method.
    """

    @abstractmethod
    def accept(self, obj: Any) -> bool:
        """
        Checks whether a given object is valid or not.

        Args:
            obj: object to be checked

        Returns:
            Returns 'True' if the given object is valid; Otherwise 'False'.
        """
        pass

    @abstractmethod
    def modify(self, obj: Any) -> Any:
        """
        Converts or modify a given object into the required format for further
        processing.

        Args:
            obj: given object

        Returns:
            Returns a modified instance of the given object.
        """
        pass

    @abstractmethod
    def supply(self, *args, **kwargs) -> Iterable[Any]:
        """
        Returns a sequence of objects from one or more data sources.

        Args:
            args: positional arguments required by supplier
            kwargs: keyword arguments required by supplier

        Returns:
            Returns a sequence of objects for processing.
        """
        pass

    def collect(self, *args, **kwargs) -> Iterable[Any]:
        """
        Reads a filtered sequence of modified objects from the given supplier
        method.

        Args:
            args: positional arguments required by supplier
            kwargs: keyword arguments required by supplier

        Returns:
            Returns a generator object processing all items from the given
            supplier method.
        """
        return (self.modify(obj) for obj in self.supply(*args, **kwargs) if self.accept(obj))
